name: Add commit comment to issue

on:
  push:
    branches:
      - '**'  # ëª¨ë“  ë¸Œëœì¹˜ì—ì„œ ì‘ë™

jobs:
  comment:
    runs-on: ubuntu-latest
    steps:
      - name: Extract and group commit messages by issue
        uses: actions/github-script@v7
        with:
          script: |
            const commits = context.payload.commits;
            const issuePattern = /#(\d+)/g;

            const issueCommitsMap = {};

            for (const commit of commits) {
              const message = commit.message;
              const matches = [...message.matchAll(issuePattern)];

              for (const match of matches) {
                const issueNumber = match[1];

                if (!issueCommitsMap[issueNumber]) {
                  issueCommitsMap[issueNumber] = [];
                }

                issueCommitsMap[issueNumber].push(message.trim());
              }
            }

            for (const issueNumber in issueCommitsMap) {
              const commitsText = issueCommitsMap[issueNumber]
                .map(msg => `> ${msg}`)
                .join('\n'); // âœ… ì§„ì§œ ì¤„ë°”ê¿ˆ

              const body = [
                'ğŸ’¬ ì´ë²ˆ í‘¸ì‹œì— í¬í•¨ëœ ì»¤ë°‹ ëª©ë¡ì…ë‹ˆë‹¤:',
                '',
                commitsText
              ].join('\n');

              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issueNumber,
                body
              });
            }
