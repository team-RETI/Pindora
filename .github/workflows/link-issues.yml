name: Add commit comment to issue

on:
  push:
    branches:
      - main
      - develop

jobs:
  comment:
    runs-on: ubuntu-latest
    steps:
      - name: Extract commit messages
        uses: actions/github-script@v7
        with:
          script: |
            const commits = context.payload.commits;
            const issuePattern = /#(\d+)/g;

            for (const commit of commits) {
              const message = commit.message;
              const matches = [...message.matchAll(issuePattern)];
              for (const match of matches) {
                const issueNumber = match[1];
                const commentBody = `💬 커밋 [\`${commit.id.substring(0, 7)}\`](${commit.url}) 가 이슈에 추가되었습니다.\n\n> ${message}`;
                
                await github.rest.issues.createComment({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: issueNumber,
                  body: commentBody
                });
              }
            }
